<!DOCTYPE html>
<html>
<head>
    <title>CS 3300 Project 2</title>
    
    <!-- JavaScript
    ================================================== -->
    <script src="d3.v3.min.js" charset="utf-8"></script>
    <script src="topojson.v1.min.js"></script>
    
    <!-- Basic Page Styles
    ================================================== -->
	<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto+Slab:400,700' rel='stylesheet' type='text/css'>
    <style>
        * { box-sizing: border-box; }
        body { width: 1000px; margin: 3em auto; font-family: "Roboto Slab"; }
        html { background: #dfdfdf; font-family: sans-serif; font-size: 1.05em; line-height: 1.25; }
        .paper { width: 100%; background: #fff; border: 1px solid #cfcfcf; box-shadow: 0px 3px 4px 0px rgba(0,0,0,0.2); font-family: Montserrat; }
        .card { padding: 1.5em 2.5em; margin: 3em auto; }
        .sheet { padding: 5em; margin: 3em auto; }
        p { margin-bottom: 2em; }
        small, .muted { color: #555; }
        header { margin-bottom: 5em; }
        .response { display: inline-block; line-height: 1.5; border-left: 3px solid #dfdfdf; padding: .5em 0 .5em 1.5em; }
		.main-title { color: #444; font-size: 3.5em; text-align: center; margin: .5em auto; padding: 0; font-family: "Roboto Slab"; }
		.sub-title { color: #555; font-size: 1.35em; line-height: 1.75; text-align: center; border-top: 1px solid #dfdfdf; padding-top: 1em; }
		.section-title { color: #444; font-size: 3.5em; text-align: center; margin: 2em auto .5em auto; padding: 0; }
		svg { }
    </style>
</head>
<body>
	
	<header class="paper card">
		<h1 class="main-title">
			HIV/AIDS and Poverty in the United States<br>
		</h1>
		<p class="sub-title">
			<b>CS 3300 Project Two</b><br>
			Names --
		</p>
	</header>
    
	<!-- Overview Map
    ================================================== -->
	<section>
		<h2 class="section-title">Overview Map</h2>
		<div id="map" class="paper">
			<button type="button" id="unemp-button" onclick="color_states_unemployment()">Unemployment Rate</button>
			<button type="button" id="poverty-button" onclick="color_states_poverty()">Poverty Rate</button>
			<button type="button" id="infect-button" onclick="color_states_hiv()">HIV/AIDS Infection</button>
			<button type="button" id="deaths-button" onclick="color_states_hiv_deaths()">HIV/AIDS Deaths</button>



		</div>

		<div id="state-panel" class="paper">

			<p id="state-name"></p>

			<p id="state-data"></p>

		</div>
	

		<!-- Overview Map Styles
		================================================== -->
		<style>
			.state-2, .state-15 { fill: none; stroke: none; display: none; }
			#map .label {
				fill: #555;
				font-size: 14px;
				font-weight: bold;
				text-anchor: middle;
			}
		</style>

		<!-- Generate Overview Map Visuals
		================================================== -->
		<script>		


			var ovMapWidth = 1000,
				ovMapHeight = 618;
			
			var ovMapprojection = d3.geo.albersUsa().scale(800).translate([ovMapWidth / 2, ovMapHeight / 2]);
			var usaPathData = d3.geo.path().projection(ovMapprojection);
			
			// Sets up SVG Canvas within #map element	
			var map_svg = d3.select("#map").append("svg")
				.attr("width", ovMapWidth)
				.attr("height", ovMapHeight);
			var usaData;
			var statePaths;
			var statesData;

			var state_ids = {};
			var id_states = {};
			
			// Draws the map of the USA
			d3.json("us.json", function(error, usa) {
				usaData = usa;
				statesData = topojson.feature(usa, usa.objects.states).features;
				statePaths = map_svg.append("g");
				
				// Draws each state. Each state should have attribute id = "state-##"
				statePaths.selectAll("path").data(statesData)
					.enter().append("path").attr("d", usaPathData)
					.attr("class", function(state) { return "state-" + state.id; })
					.on("click", function (state) { switch_to_state(state.id); })
					.attr("fill", "#dfdfdf")
					.style("stroke", "#fff")
					.style("stroke-width", "1.5");
					
				
				/* Show enrollment color scale key on map */
				/*
				enrollcs = map_svg.append("g");
				
				enrollcs.append("text")
					.text("Map Scale Description")
					.attr("x", 50).attr("y", 585)
					.attr("fill", "#777")
					.attr("font-size", "12");
				
				for (var i = 0; i < enrollmentColorScale.length; i++) {
					var xpos = 50 + 15*i;
					var ypos = 560;
					
					enrollcs.append("rect")
						.attr("x", xpos).attr("y", ypos + 5)
						.attr("height", 7).attr("width",15)
						.attr("fill", enrollmentColorScale[i]);

					var scaletext;
					var scaletextcolor = (i % 2 == 0)? "#a7a7a7" : "#dfdfdf";
					if (i == 0) {
						scaletext = "0%";
					}
					else if (i < 5) {
						scaletext = "0." + (i * 2) + "%";
					}
					else if (i == 5) {
						scaletext = "1%";
					}
					else {
						scaletext = (2 + 2 * (i - 6)) + "%";
					}

					enrollcs.append("text")
						.text(scaletext)
						.attr("x", xpos).attr("y", ypos)
						.attr("fill", scaletextcolor)
						.attr("font-size", 10)
						.attr("dominant-baseline", "middle")
						.attr("transform", "rotate(-60," + xpos + ", " + ypos + ")");
				}*/

				//Holds the IDs of each state. 
				//Access ID of state using state_ids[Statename]
				

				d3.csv("stateids.csv", function (error, data) {
					data.forEach(function(row) {
						state_ids[row.State] = row.id;
						id_states[row.id] = row.State;
					});
					color_states_unemployment();
				});
				
				
				/* Draw Regional Overview Circles */
				var regionRadialScale = d3.scale.sqrt()
					.domain([0,1]).range([0, 75]);

			});

				/* Shade states based on unemployment data */
				function color_states_unemployment () {
					d3.csv("statedata.csv", function (error, data) {										
						data.forEach(function(row){
							map_svg.select(".state-" + state_ids[row.state])
								.attr("fill", unemployment_color_scale(row.unemploymentrate));
						});
					});

				}

				/* Shade states based on poverty rate data */
				function color_states_poverty () {
					d3.csv("statedata.csv", function (error, data) {										
						data.forEach(function(row){
							map_svg.select(".state-" + state_ids[row.state])
								.attr("fill", poverty_color_scale(row.povertyrate));
						});
					});

				}

				/* Shade states based on HIV data */
				function color_states_hiv () {
					d3.csv("statedata.csv", function (error, data) {										
						data.forEach(function(row){
							map_svg.select(".state-" + state_ids[row.state])
								.attr("fill", hiv_color_scale(row.hivaidsdiagnosisrate));
						});
					});

				}

				/* Shade states based on HIV death data */
				function color_states_hiv_deaths () {
					d3.csv("statedata.csv", function (error, data) {										
						data.forEach(function(row){
							map_svg.select(".state-" + state_ids[row.state])
								.attr("fill", hiv_death_color_scale(row.hivaidsmortality));
						});
					});

				}

				//switches the display below to the given stateid
				function switch_to_state (state_id) {
					//TODO
					console.log("Switching to state " + state_id);
					d3.csv("statedata.csv", function (error, data) {
						var selected_state;
						data.forEach(function (row) {
							if (state_ids[row.state] == row.State) {
								selected_state = row;
							}
						});

						var state_name = d3.select("#state-name");
						var state_data = d3.select("#state-data");

						state_name.text(id_states[selected_state.State]);
						var state_data_text = "";
						state_data_text += ("population: " + selected_state.population + "\n");
						state_data_text += ("povertyrate: " + selected_state.povertyrate + "\n");
						state_data_text += ("medianincome: " + selected_state.medianincome + "\n");
						state_data_text += ("unemploymentrate: " + selected_state.unemploymentrate + "\n");
						state_data_text += ("foodstamprecipients: " + selected_state.foodstamprecipients + "\n");
						state_data_text += ("hivaidsdiagnosisrate: " + selected_state.hivaidsdiagnosisrate + "\n");
						state_data_text += ("hivaidsmortality: " + selected_state.hivaidsmortality + "\n");
						state_data_text += ("hivaidsfunding: " + selected_state.hivaidsfunding + "\n");
						
						
						state_data.text(state_data_text);
					});
				}
			
		</script>
    </section>
    
	
	
	
	
	
	<!-- General Utility Functions
	================================================== -->
	<script>


		var r_scale;
		var s_scale;

		/**
		 * Returns the given number as a string with commas as separators.
		 * e.g. 34567 -> "34,567"
		 * src: http://stackoverflow.com/questions/2901102/how-to-print-a-number
		 * -with-commas-as-thousands-separators-in-javascript
		 */
		function numberWithCommas(x) {
    		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		}

		//returns the color associated with the given unemployment rate
		function unemployment_color_scale (unemployment_rate) {

			//TODO: STUB
			var r = Math.floor(Math.random() * 3);

			if (r == 0) return "#ff0000";
			if (r == 1) return "#00ff00";
			if (r == 2) return "#0000ff";

			else console.log("wow you broke random...");
		}

		//returns the color associated with the given HIV/AIDS diagnosis rate
		function hiv_color_scale(hiv_rate) {

			//TODO: STUB
			var r = Math.floor(Math.random() * 3);

			if (r == 0) return "#ff0000";
			if (r == 1) return "#00ff00";
			if (r == 2) return "#0000ff";

			else console.log("wow you broke random...");
		}

		//returns the color associated with the given HIV/AIDS death rate
		function hiv_death_color_scale(hiv_death_rate) {

			//TODO: STUB
			var r = Math.floor(Math.random() * 3);

			if (r == 0) return "#ff0000";
			if (r == 1) return "#00ff00";
			if (r == 2) return "#0000ff";

			else console.log("wow you broke random...");
		}

		//returns the color associated with the given poverty rate
		function poverty_color_scale(poverty_rate) {

			//TODO: STUB
			var r = Math.floor(Math.random() * 3);

			if (r == 0) return "#ff0000";
			if (r == 1) return "#00ff00";
			if (r == 2) return "#0000ff";

			else console.log("wow you broke random...");
		}
		
		
	</script>
	
	
	
</body>
</html>